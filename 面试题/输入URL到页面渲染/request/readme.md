# 输入URL之后

# DNS解析
确定对方的IP地址：我们怎样通过一个www.....的网址（域名）知道ip地址呢？使用IP协议做DNS解析
  将域名对应的IP地址找到：
  - 当我输入一个网址例如www.baidu.com时
    1. 去操作系统的本地缓存中查询IP（查询一下是否之前就已经缓存过该域名的IP）
    2. 如果本地缓存中没有该域名的IP地址，那么就会去系统配置的DNS服务器（DNS高速缓存）中查询
    3. 如果DNS服务器中也没有该域名的IP地址，那么就会去根服务器中查询
    4. 如果根服务器中也没有该域名的IP地址，那么就会去COM顶级域名服务器（它记录了所有.com域名所对应的IP地址）中查询
    5. 如果COM顶级域名服务器中也没有该域名的IP地址，那么就会去baidu.com这个域名服务器（它记录了所有.baidu.com域名所对应的IP地址）中查询

# UDP协议和TCP协议

## UDP协议（保证时效性，应用场景为实时的数据传输，例如在线游戏、直播、视频通话等）
1. 无连接：不需要在正式传输数据之前建立双方的连接
2. 只是数据报文的搬运工，不会对数据报文进行拆分和拼接

- 不可靠性（面向无连接，不会备份数据，没有拥塞控制）
- 高效性

- 传输方式：一对一、一对多、多对一、多对多

## TCP协议（保证可靠传输，应用场景为长连接，例如HTTP、FTP、SMTP等）
1. 连接：需要握手来建立和断开连接
  - 三次握手建立连接
    1. 客户端向服务端发送建立连接请求，客户端进入SYN-SEND状态
    2. 服务端收到建立连接的请求后，向客户端发送一个应答，服务端进入SYN-RECIVED状态
    3. 客户端收到应答后，再次发送确认接收到应答，双方都进入ESTAB状态
    如果只有两次握手就建立连接进入ESTAB状态的话会造成资源浪费，无法自动关闭，服务端会一直等待。三次握手的话数据包超时发送，重发数据包服务端接收后只会进入SYN-RECIVED状态，超时会自动关闭，不会进入ESTAB状态（需要四次握手才能关闭无法自动关闭），就不会出现资源浪费。

  - HTTP通信————看Http.md

  - 四次握手断开连接
    1. 客户端A向服务端B发送断开连接请求
    2. B接收到断开连接请求后，告诉应用层（有物理层———交换机、网络层——路由器、传输层——例如水晶插头、应用层——终端设备）释放TCP连接，此时B仍然可以给A发送数据包
    3. B向A发送最后一个数据包后，进入LAST-ACK状态
    4. A接收到B的释放连接请求后，向B确认应答，双方都进入CLOSED状态
2. 通过各种算法对数据报文进行拆分和拼接，对数据报文进行备份，对数据报文进行校验，对数据报文进行重发，保证数据的可靠传输
  - TCP头部字段：
  1. Sequence Number：序列号————给每一个数据报文都打上一个序列号，保证数据的有序传输
  2. Acknowledgment Number：确认号————告诉对方我收到了多少数据，如果存在没有收到的数据，会进行重发
  3. 标识符：
    - URG = 1：表示优先级最高的数据包
    - ACK = 1：确认号，表示该数据包有效用于确认收到多少数据
    - SYN = 1，ACK = 0：连接请求报文
    - FIN = 1，ACK = 1：应答连接报文

- 可靠性（面向连接，会备份数据，拥塞控制）